name: Continuous Deployment

on:
    push:
        tags: ["v*", "workflow_dispatch"]

jobs:
    unit-tests:
        uses: ./.github/workflows/unit-tests.yml

    build:
        uses: ./.github/workflows/build.yml
        with:
            version: ${{ github.ref_name }}

    release:
        name: Release
        needs: [build, unit-tests]
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - name: Checkout Project
              uses: actions/checkout@v4

            - name: Download Replecs
              uses: actions/download-artifact@v4
              with:
                  name: build
                  path: build

            - name: Rename Build
              run: mv build/replecs.rbxm replecs.rbxm

            - name: Create Release
              uses: softprops/action-gh-release@v1
              with:
                  name: Replecs ${{ github.ref_name }}
                  files: |
                      replecs.rbxm
