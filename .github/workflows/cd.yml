name: Continuous Deployment

on:
    push:
        tags: ["v*", "workflow_dispatch"]

jobs:
    unit-tests:
        uses: ./.github/workflows/unit-tests.yml

    build:
        uses: ./.github/workflows/build.yml

    release:
        name: Release
        needs: [build, unit-tests]
        runs-on: ubuntu-latest
        permissions:
            contents: write
        steps:
            - name: Checkout Project
              uses: actions/checkout@v4

            - name: Download Replecs
              uses: actions/download-artifact@v4
              with:
                  name: build
                  path: build

            - name: Rename Build
              run: mv build/replecs.rbxm replecs.rbxm

            - name: Create Release
              uses: softprops/action-gh-release@v1
              with:
                  name: Replecs ${{ github.ref_name }}
                  files: |
                      replecs.rbxm

    # publish:
    #name: Publish
    #needs: [release]
    #runs-on: ubuntu-latest
    #steps:
    #- name: Checkout Project
    #  uses: actions/checkout@v4

    #- name: Install Rokit
    #  uses: CompeyDev/setup-rokit@v0.1.2

    #- name: Wally Login
    #  run: wally login --token ${{ secrets.WALLY_AUTH }}

    #- name: Publish
    #  run: wally publish
